import { defineComponent as e, ref as t, onMounted as a, watch as l, openBlock as r, createElementBlock as o, createElementVNode as u, renderSlot as n, createVNode as s, withCtx as p, createTextVNode as i, toDisplayString as d, withModifiers as c, createBlock as f, createCommentVNode as m, resolveDynamicComponent as v, render as _ } from "vue";
import { _ as y } from "./button-y8Aj-aBT.js";
import { _ as b, b as h } from "./input-BhldYW3K.js";
import { _ as w } from "./text-TjewgIQ-.js";
import { u as k } from "./popup-wrapper-DVF5gLbi.js";
const x = { class: "nue-prompt__header" }, C = { class: "nue-prompt__content" }, T = { class: "nue-prompt__footer" }, E = e({ name: "NuePromptNode", __name: "prompt", props: { title: { default: "Prompt" }, label: {}, placeholder: { default: "Please input" }, inputType: { default: "text" }, inputValue: { default: "" }, confirmButtonText: { default: "Yes" }, cancelButtonText: { default: "No" }, closeOnError: { type: Boolean }, close: {}, validator: {}, beforeConfirm: {}, onConfirm: {} }, setup(e2) {
  const _2 = e2, k2 = t(), E2 = t(), g2 = t(_2.inputValue), B = t(false), V = t("无效的输入值"), j = t(false), N = async (e3) => {
    const { close: t2, onConfirm: a2, closeOnError: l2 } = _2, r2 = g2.value;
    if (!e3) return t2(false, "");
    B.value = false;
    const o2 = await (async () => {
      const { validator: e4 } = _2, t3 = g2.value;
      if (!e4) return true;
      try {
        if (j.value = true, await e4(t3)) return B.value = false, true;
        throw new Error("无效的输入值");
      } catch (e5) {
        return B.value = true, "string" == typeof e5 ? V.value = e5 : e5 instanceof Error ? V.value = e5.message : V.value = "无效的输入值", j.value = false, false;
      }
    })();
    if (o2) {
      if (!a2) return t2(true, r2);
      try {
        j.value = true, await a2(r2), t2(true, r2);
      } catch (e4) {
        if (l2) return void t2(false, e4 instanceof Error ? e4 : new Error(e4));
        B.value = true, V.value = "string" == typeof e4 ? e4 : "无效的输入值";
      } finally {
        j.value = false;
      }
    }
  };
  return a(() => {
    requestAnimationFrame(() => {
      E2.value.innerInputRef.focus();
    });
  }), l(() => g2.value, () => B.value = false), (e3, t2) => (r(), o("div", { ref_key: "promptRef", ref: k2, class: "nue-prompt" }, [u("div", x, [n(e3.$slots, "header", {}, () => [s(w, null, { default: p(() => [i(d(e3.title), 1)]), _: 1 }), s(y, { disabled: j.value, icon: "clear", theme: "pure", onClick: t2[0] || (t2[0] = c((e4) => N(false), ["stop"])) }, null, 8, ["disabled"])])]), u("div", C, [n(e3.$slots, "default", {}, () => [e3.label ? (r(), f(w, { key: 0, class: "nue-prompt__label" }, { default: p(() => [i(d(e3.label), 1)]), _: 1 })) : m("", true), (r(), f(v("textarea" === e3.inputType ? b : h), { ref_key: "promptInputRef", ref: E2, modelValue: g2.value, "onUpdate:modelValue": t2[1] || (t2[1] = (e4) => g2.value = e4), disabled: j.value, placeholder: e3.placeholder, type: e3.inputType }, null, 8, ["modelValue", "disabled", "placeholder", "type"])), B.value ? (r(), f(w, { key: 1, class: "nue-prompt__value-error" }, { default: p(() => [i(d(V.value), 1)]), _: 1 })) : m("", true)])]), u("div", T, [n(e3.$slots, "footer", {}, () => [s(y, { disabled: j.value, onClick: t2[2] || (t2[2] = c((e4) => N(false), ["stop"])) }, { default: p(() => [i(d(e3.cancelButtonText), 1)]), _: 1 }, 8, ["disabled"]), s(y, { loading: j.value, theme: "primary", onClick: t2[3] || (t2[3] = c((e4) => N(true), ["stop"])) }, { default: p(() => [i(d(e3.confirmButtonText), 1)]), _: 1 }, 8, ["loading"])])])], 512));
} }), g = (e2) => {
  const t2 = k(e2.wrapperId);
  return new Promise((a2, l2) => {
    const r2 = document.createElement("div");
    r2.classList.add("nue-prompt-wrapper"), t2.appendChild(r2), _(s(E, { ...e2, close: (e3, o2) => {
      e3 ? a2(o2) : l2(o2), r2.dataset.closing = "true", setTimeout(() => {
        t2.removeChild(r2);
      }, 240);
    } }), r2);
  });
};
export {
  g as N
};
